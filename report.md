# report

### 设计思路

分成三部分：

### 实现方法

#### 一、

#### 二、 IR树生成

1. 在对kernel表达式进行语法分析的同时构建对应的IR树：

    在一个栈中存放当前已规约表达式对应IR树的节点。每通过一个新的产生式进行规约，就结合栈中已有的元素构造新的节点，并将其压入栈中

2. 得到表达式对应IR树后，依照求和规范将表达式拆成若干求和部分：
    遍历IR树，遇到+,-节点则说明当前节点需要继续拆分，否则该节点对应一个独立求和部分

3. 对循环变量进行边界推断：
    语法分析过程中，每得到一个TRef项，对于其每个下标项导出两个不等式，将这些不等式单独保存起来。使用这些不等式便可以粗略推出各个循环变量的上下界。

4. 生成外层求和循环语句：

    扫描kernel表达式左侧出现的变量，将其作为最外层的循环变量。对于每个求和部分，找出未出现在表达式左侧的变量，构建相应循环语句，结合该部分的表达式得到这一求和部分的语句。将所有部分的语句组合，得到完整的循环体。

    由于边界推断的结果不能准确限定循环范围，故在生成循环语句过程中的每一处，都会维护"已出现的循环变量列表"，并扫描语法分析得出的不等式列表，只要不等式中所有的变量都已出现过，就在当前位置放置该不等式对应的if语句，尽可能早地终止不必要的循环。

#### 三、


### 组内分工

宋苑铭：

朱立人：

魏龙：IR树生成